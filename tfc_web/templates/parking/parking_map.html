{% extends "template.html" %}
{% block head %}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
{% endblock %}
{% block content %}
    <div style="height: 80vh;">
        <div id="title" style="height: 5%; width: 100%;">Car Parks</div>
        <div id="map" style="height: 90%; width: 100%;"></div>
    </div>
    <script>

        var PARKING_PLOT_URL = "/web/parking/plot/";
        
        // could use 'Area' concept here
        var map = L.map('map').setView([52.2038, 0.1207], 14);
        var mapMarkers = [];
        var busIcon = L.icon({
            iconUrl: 'https://upload.wikimedia.org/wikipedia/commons/c/c3/RWB_Parkhaus.svg',
            iconSize: [30, 30]
        });

        // ********************************************************************************
        // *************  Parking list info provided by server ****************************
        // ********************************************************************************
        
        var parking_list = (JSON.parse( '{{ config_parking_list|escapejs }}' ))["request_data"]["parking_list"];
        
        // ********************************************************************************
        // *************  end of server parking list info      ****************************
        // ********************************************************************************
        
        for ( var i = 0; i < parking_list.length; i++) {
                var marker = L.marker([ parking_list[i]["latitude"],
                                        parking_list[i]["longitude"]
                                      ],
                                      { icon: busIcon}
                             )
                        .addTo(map)
                        .bindPopup(
                             '<a href="'+
                             PARKING_PLOT_URL+
                             '/'+
                             parking_list[i]['parking_id']+
                             '" >' +
                             'Car Park: ' +
                             parking_list[i]["parking_name"] +
                             '</a>'
                                  );
                mapMarkers.push(marker);
        }

        $(document).ready(function() {
            L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
        });

    </script>
{% endblock %}
