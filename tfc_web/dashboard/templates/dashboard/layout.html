{% load static %}
{% load remove_underscore %}
<!DOCTYPE html>
<html>
<head>
    <title>SmartCambridge dashboard</title>
    <link rel="stylesheet" href="{% static 'dashboard/dashboard.css' %}"/>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.teal-green.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    {% for key, value in confdata.items %}
        {% if value.configuration %}
        <script src="{% static 'dashboard/widgets' %}/{{ value.configuration.widget }}/{{ value.configuration.widget }}.js"></script>
        {% endif %}
    {% endfor %}
</head>
<body>
    <div class="logos" style="height: 60px;">
        <div id="screen_clock"></div>
        <a href="https://www.greatercambridge.org.uk/"><img alt="Greater Cambridge Partnership" src="{% static 'images/logo_gccd_112.png' %}"></a>
        <a href="http://www.connectingcambridgeshire.co.uk/smartcamb/"><img alt="Connecting Cambridgshire" src="{% static 'images/logo_sc_112.png' %}"></a>
        <a href="http://www.cam.ac.uk"><img alt="The University of Cambridge" src="{% static 'images/logo_uc_112.png' %}"></a>
        <span style="font-weight: bold; font-size: 50px; position: absolute; right: 0.5em;">Adaptive Cities Platform</span>
    </div>
    <div class="grid-container mdl-color--teal-900" style="height: calc((100vw - 80px) * 0.5625); overflow: hidden;">
        <ul id="grid" class="grid">
            {% for key, value in confdata.items %}
                <li style="position: absolute; height: calc({{ value.design.h }}*100%/4);
                        width: calc({{ value.design.w }}*100%/6); top: calc({{ value.design.y }}*100%/4);
                        left: calc({{ value.design.x }}*100%/6); border: solid 1px black; margin: 1px;">
                    <div id="widget-{{ key }}" style="height: 100%; width: 100%; background-color: white;">
                        {% if not value.configuration %}unconfigured{% endif %}</div></li>
            {% endfor %}
        </ul>
    </div>
    <script>
        var widget = [];
        {% for key, value in confdata.items %}
            {% if value.configuration %}
            widget.push(new {{ value.configuration.widget|title|remove_underscore }}('widget-{{ key }}',
                {{ value.configuration.data|safe }}));
            {% endif %}
        {% endfor %}

        function update_screen_clock() {
            var datetime = new Date();
            var hh = ('0'+datetime.getHours()).slice(-2);
            var mm = ('0'+datetime.getMinutes()).slice(-2);
            var ss = ('0'+datetime.getSeconds()).slice(-2);
            document.getElementById('screen_clock').innerHTML = hh+':'+mm+':'+ss;
        }

        $().ready(function () {
            setInterval(update_screen_clock, 1000);
            for (var i = 0; i < widget.length; i++)
                if ('init' in widget[i])
                    widget[i].init();
        });

    </script>
</body>
</html>
