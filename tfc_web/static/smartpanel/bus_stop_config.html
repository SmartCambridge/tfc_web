<html>

<head>

    <title>Bus Stop Config</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.1/leaflet.css" integrity="sha256-B5Af7a59HZfTwOlorb6pQSEj6l8I3jj785fgpPiLnx4="  crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.css"
    integrity="sha256-XzD3RpaHPv7lzX9qt+2n1j5cWj48O24KsgaGYpKN8x8=" crossorigin="anonymous" />

    <link rel="stylesheet" href="bus_stop_chooser/bus_stop_chooser.css"/>

    <link rel="stylesheet" href="widget_config.css"/>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.1/leaflet.js" integrity="sha256-CX9/BWJ5F1oC8mbqO5CMChjvkuoBQF8FTujU6xO5eB0="  crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.js"
    integrity="sha256-jzmB6xy6L0YPzPeu+ccUiPKp3UE+qRmo5xmq5BbnSv0=" crossorigin="anonymous"></script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAEkMI-ZAAt1kjv668jfBXhNB1-odv5m3g">
    </script>

    <script src="bus_stop_chooser/bus_stop_chooser.js"></script>

    <script src="widget_config.js"></script>

    <script>

    var stops = [
      {
        "id": "0500CCITY002",
        "stop_id": "0500CCITY002",
        "atco_code": "0500CCITY002",
        "naptan_code": "CMBDADAG",
        "common_name": "Great St Mary's Church",
        "indicator": "near",
        "locality_name": "Cambridge",
        "longitude": 0.11798986495,
        "latitude": 52.2056312981
      },
      {
        "id": "0500SCAMB020",
        "stop_id": "0500SCAMB020",
        "atco_code": "0500SCAMB020",
        "naptan_code": "CMBGMGWM",
        "common_name": "Play Area",
        "indicator": "near",
        "locality_name": "Upper Cambourne",
        "longitude": -0.0607340131,
        "latitude": 52.2198629227
      },
      {
        "id": "0500CCITY111",
        "stop_id": "0500CCITY111",
        "atco_code": "0500CCITY111",
        "naptan_code": "CMBDAJDM",
        "common_name": "Christ's College",
        "indicator": "opp",
        "locality_name": "Cambridge",
        "longitude": 0.12152333326,
        "latitude": 52.2063770821
      },
      {
        "id": "0500CCITY440",
        "stop_id": "0500CCITY440",
        "atco_code": "0500CCITY440",
        "naptan_code": "CMBDGDTP",
        "common_name": "Bene't Street",
        "indicator": "opp",
        "locality_name": "Cambridge",
        "longitude": 0.11902718402,
        "latitude": 52.2043627963
      },
    ];

    cambridge = {
        "map": {
            "lng": 0.124,
            "lat": 52.204,
            "zoom": 10
        }
    };

    oxford = {
        "map": {
            "lng": -1.2484477217936956,
            "lat": 51.75424465586892,
            "zoom": 12
        }
    };

    area = [
        {
          "lat": 52.212062421011574,
          "lng": 0.07910639047622682
        },
        {
          "lat": 52.22675779769572,
          "lng": 0.14675974845886233
        },
        {
          "lat": 52.06473391193371,
          "lng": 0.25399446487426763
        },
        {
          "lat": 52.0497391992329,
          "lng": 0.15151798725128177
        }
    ];

    foo = {
  "map": {
    "lng": 0.1665504276752472,
    "lat": 52.13842085762876,
    "zoom": 7
  },
  "areas": [
    [
      {
        "lat": 52.212062421011574,
        "lng": 0.07910639047622682
      },
      {
        "lat": 52.22675779769572,
        "lng": 0.14675974845886233
      },
      {
        "lat": 52.06473391193371,
        "lng": 0.25399446487426763
      },
      {
        "lat": 52.0497391992329,
        "lng": 0.15151798725128177
      }
    ],
    [
      {
        "lat": 52.29121336250577,
        "lng": 0.14350354671478274
      },
      {
        "lat": 52.29224034665484,
        "lng": 0.29096066951751715
      },
      {
        "lat": 52.255427956438815,
        "lng": 0.2775657176971436
      }
    ]
  ]
};

    $().ready(function () {

        var config_tbody = document.getElementById("body");

        console.log("Before call");
        var bus_stops = config_input(config_tbody,
                                    'bus_stops',
                                    { text: 'Bus Stops',
                                      title: 'Choose bus stops',
                                      //width: "500px",
                                      //height: "500px",
                                      //multi_select: false,
                                      //zoom_threshold: 15,
                                      //lat: 52.204
                                      //lng: 0.124
                                      //zoom: 15
                                    },
                                    { stops: stops }
        );
        console.log("Before call");

        var leaflet_map = config_input(config_tbody,
                                       'leaflet_map',
                                       {
                                           text: 'Leaflet map',
                                           title: 'Choose Leaflet map',
                                           //width: "500px",
                                           //height: "500px",
                                           //lat: 52.204
                                           //lng: 0.124
                                           //zoom: 15
                                       },
                                       {}
        );

        var google_map = config_input(config_tbody,
                                       'google_map',
                                       {
                                           text: 'Google map',
                                           title: 'Choose Google map',
                                           //width: "500px",
                                           //height: "500px",
                                           //show_traffic: false,
                                           //lat: 52.204
                                           //lng: 0.124
                                           //zoom: 15
                                       },
                                       {}
        );

        var polygon = config_input(config_tbody,
                                       'area',
                                       {
                                           text: 'Area',
                                           title: 'Draw an area',
                                           //width: "500px",
                                           //height: "500px",
                                           //lat: 52.204
                                           //lng: 0.124
                                           //zoom: 15
                                       },
                                       { areas: [ area ] }
        );


        $('#save').click(function() {
            var data = JSON.stringify(bus_stops.value(), null, 2);
            data += "\n\n";
            data += JSON.stringify(leaflet_map.value(), null, 2);
            data += "\n\n";
            data += JSON.stringify(google_map.value(), null, 2);
            data += "\n\n";
            data += JSON.stringify(polygon.value(), null, 2);

            console.log("Retrieved data", data);
            $("#results").text(data);

        });

    });

    </script>

</head>

<body >

    <table>
        <tbody id="body">
        </tbody>
    </table>

    <button id="save" name="button">Click me</button>

    <pre id="results">Aardvark</pre>

</body>

</html>